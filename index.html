<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance MT5 Trading Assistant</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Space+Grotesk:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^0.7.0",
    "marked": "https://esm.sh/marked@^4.3.0"
  }
}
</script>
    <script type="module" src="index.tsx"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1>Binance MT5 Trading Assistant</h1>
            <p>Your AI partner for strategy and code</p>
        </div>
        <div id="market-ticker-container"></div>
        <div class="header-actions">
            <button id="strategy-builder-button" class="header-button header-button-special" aria-label="Open Strategy Builder" title="Open Strategy Builder">
                 <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M14 6v15H3v-2h2V3h9v1h5v15h2v2h-4V6h-3zm-4 5v2h2v-2h-2z"/></svg>
                <span>Strategy Builder</span>
            </button>
            <button id="analysis-button" class="header-button header-button-primary" aria-label="Get AI-powered market analysis" title="Get AI-powered market analysis">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.09-4-4L2 16.99l1.5 1.5z"/></svg>
                <span>Market Analysis</span>
            </button>
            <button id="calendar-button" class="header-button header-button-primary" aria-label="Fetch economic calendar events" title="Fetch economic calendar events">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zM5 8V6h14v2H5z"/></svg>
                <span>Economic Calendar</span>
            </button>
            <button id="news-button" class="header-button header-button-primary" aria-label="Fetch latest trading news" title="Fetch latest trading news">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H8V4h12v12zM10 9h8v2h-8zm0 3h4v2h-4z"/></svg>
                <span>Latest News</span>
            </button>
            <button id="print-pdf-button" class="header-button header-button-secondary" aria-label="Print chat to PDF" title="Print chat to PDF">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zM16 18H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zM18 3H6v4h12V3z"/></svg>
                <span>Print PDF</span>
            </button>
            <button id="clear-history-button" class="header-button header-button-secondary" aria-label="Clear chat history" title="Clear chat history">
                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 0 24 24" width="24px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"/></svg>
                <span>Clear History</span>
            </button>
        </div>
    </header>
    <div class="main-content">
        <main id="chat-container"></main>
    </div>
    <footer>
        <form id="prompt-form">
            <div class="textarea-wrapper">
                <textarea id="prompt-input" placeholder="e.g., Generate an MQL5 Expert Advisor for RSI divergence..." rows="1" required></textarea>
            </div>
            <button type="submit" aria-label="Send message">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
        </form>
    </footer>

    <!-- Strategy Builder Modal -->
    <dialog id="strategy-builder-modal">
        <form id="strategy-builder-form">
            <header class="modal-header">
                <h2>Strategy Builder</h2>
                <button type="button" id="close-builder-button" aria-label="Close Strategy Builder">&times;</button>
            </header>
            <div class="modal-content">
                <!-- Column 1 -->
                <div class="modal-column">
                    <fieldset>
                        <legend>Strategy Details</legend>
                        <div class="form-group">
                            <label for="strategy-name">Strategy Name</label>
                            <input type="text" id="strategy-name" required value="MyAwesomeStrategy">
                        </div>
                        <div class="form-group">
                            <label for="strategy-symbol">Symbol</label>
                            <input type="text" id="strategy-symbol" required value="BTCUSDT">
                        </div>
                        <div class="form-group">
                            <label for="strategy-timeframe">Timeframe</label>
                            <select id="strategy-timeframe" required>
                                <option value="PERIOD_M1">1 Minute</option>
                                <option value="PERIOD_M5">5 Minutes</option>
                                <option value="PERIOD_M15" selected>15 Minutes</option>
                                <option value="PERIOD_M30">30 Minutes</option>
                                <option value="PERIOD_H1">1 Hour</option>
                                <option value="PERIOD_H4">4 Hours</option>
                                <option value="PERIOD_D1">1 Day</option>
                            </select>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend>Indicators</legend>
                        <div id="indicators-container"></div>
                        <button type="button" id="add-indicator-button" class="button-add">Add Indicator</button>
                    </fieldset>
                </div>
                <!-- Column 2 -->
                <div class="modal-column">
                    <fieldset>
                        <legend>Entry Conditions (Buy)</legend>
                        <div id="entry-conditions-container"></div>
                        <button type="button" class="button-add add-entry-condition">Add Condition</button>
                    </fieldset>
                    <fieldset>
                        <legend>Exit Conditions (Sell)</legend>
                        <div id="exit-conditions-container"></div>
                        <button type="button" class="button-add add-exit-condition">Add Condition</button>
                    </fieldset>
                    <fieldset>
                        <legend>Risk Management</legend>
                         <div class="form-group-row">
                            <div class="form-group">
                                <label for="stop-loss">Stop Loss (pips)</label>
                                <input type="number" id="stop-loss" value="100" min="0">
                            </div>
                            <div class="form-group">
                                <label for="take-profit">Take Profit (pips)</label>
                                <input type="number" id="take-profit" value="200" min="0">
                            </div>
                             <div class="form-group">
                                <label for="lot-size">Lot Size</label>
                                <input type="number" id="lot-size" value="0.01" step="0.01" min="0.01">
                            </div>
                        </div>
                    </fieldset>
                </div>
            </div>
            <footer class="modal-footer">
                <button type="button" id="cancel-builder-button" class="header-button header-button-secondary">Cancel</button>
                <button type="submit" id="generate-code-button" class="header-button header-button-special">Generate MQL5 Code</button>
            </footer>
        </form>
    </dialog>

    <!-- Templates for dynamic rows -->
    <template id="indicator-row-template">
        <div class="indicator-row">
            <select class="indicator-select">
                <option value="RSI">RSI</option>
                <option value="SMA">SMA</option>
                <option value="EMA">EMA</option>
                <option value="MACD">MACD</option>
                <option value="BollingerBands">Bollinger Bands</option>
                <option value="Stochastic">Stochastic</option>
            </select>
            <div class="indicator-params"></div>
            <button type="button" class="button-remove" aria-label="Remove Indicator">&times;</button>
        </div>
    </template>

    <template id="condition-row-template">
         <div class="condition-row">
            <select class="logical-operator-select">
                <option value="AND" selected>AND</option>
                <option value="OR">OR</option>
            </select>
            <select class="condition-indicator-select">
                <!-- Populated by JS -->
            </select>
            <select class="condition-operator-select">
                <option value="crosses above">Crosses Above</option>
                <option value="crosses below">Crosses Below</option>
                <option value="is above">Is Above</option>
                <option value="is below">Is Below</option>
                <option value="equals">Equals</option>
            </select>
            <select class="condition-value-type-select">
                <option value="Value" selected>Value</option>
                <option value="Indicator">Indicator</option>
            </select>
            <div class="condition-value-container">
                 <input type="number" class="condition-value-input" value="30">
                 <select class="condition-value-indicator-select hidden">
                    <!-- Populated by JS -->
                 </select>
            </div>
            <button type="button" class="button-remove" aria-label="Remove Condition">&times;</button>
        </div>
    </template>

</body>
</html>